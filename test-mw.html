<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MW Test</title>
<style>
  body{font-family:system-ui,Arial;margin:24px}
  input,button{padding:8px 10px;border:1px solid #ccc;border-radius:8px}
  .row{display:flex;gap:8px;align-items:center;margin:10px 0;flex-wrap:wrap}
  pre{background:#f7f7f7;border:1px solid #eee;padding:12px;border-radius:8px;white-space:pre-wrap}
  .hint{font-size:12px;color:#666;margin-top:4px}
</style>
</head>
<body>
  <h2>Meltwater Webhook Tester</h2>

  <div class="row">
    <label>Secret:</label>
    <input id="sec" placeholder="paste MW_WEBHOOK_SECRET" style="min-width:320px"/>
    <button onclick="saveSec()">Save</button>
    <span class="hint">Saved to this browser only.</span>
  </div>

  <div class="row">
    <button onclick="sendNews()">Send NEWS</button>
    <button onclick="sendSpike()">Send SPIKE</button>
    <button onclick="sendSent()">Send SENTIMENT</button>
  </div>

  <pre id="out">Waitingâ€¦</pre>

<script>
(function init(){
  const s = localStorage.getItem('mw_secret') || '';
  document.getElementById('sec').value = s;
})();
function saveSec(){
  localStorage.setItem('mw_secret', document.getElementById('sec').value.trim());
}

function url(){
  const s = document.getElementById('sec').value.trim();
  return '/api/meltwater_webhook?key=aj3K_29x!qP#7L' + encodeURIComponent(s);
}
function show(o){ document.getElementById('out').textContent = JSON.stringify(o, null, 2); }

async function post(payload){
  const r = await fetch(url(), {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify(payload)
  });
  const txt = await r.text().catch(()=>String(r.status));
  let j = null;
  try { j = JSON.parse(txt); } catch { j = { status:r.status, body:txt }; }
  show(j);
}

/* NEWS example (normal mention) */
function sendNews(){
  const now = new Date().toISOString();
  post({
    id: 'mw_demo_news_' + Date.now(),
    providerType: 'news',
    title: 'Coinbase Poised to Gain Most From Ethereum Bull Run: Bernstein',
    statusLine: '12.48M Reach â€” ðŸ™‚ Positive Sentiment',
    source: 'CoinmarketCap',
    links: { article: 'https://coinmarketcap.com/community/articles/example-123/' },
    published_at: now
  });
}

/* Mentions Spike example */
function sendSpike(){
  const now = new Date().toISOString();
  post({
    id: 'mw_demo_spike_' + Date.now(),
    type: 'Mentions Spike',
    title: 'X Repost Spike: Surge in Crypto Stocks Interest',
    statusLine: '2583 Social mentions on Aug 12, 8:20 AM â†‘ 121%',
    published_at: now,
    links: { app: 'https://app.meltwater.com/a/alerts?spike=1' }
  });
}

/* Sentiment Shift example */
function sendSent(){
  const now = new Date().toISOString();
  post({
    id: 'mw_demo_sent_' + Date.now(),
    type: 'Sentiment Shift',
    title: 'Sentiment Shift â€” more positive',
    statusLine: 'more positive',
    published_at: now,
    links: { app: 'https://app.meltwater.com/a/alerts?sentiment=1' }
  });
}
</script>
</body>
</html>
